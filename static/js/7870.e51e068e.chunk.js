"use strict";(self.webpackChunksewage_map=self.webpackChunksewage_map||[]).push([[7870],{17870:function(e,t,r){r.r(t),r.d(t,{default:function(){return je}});var n,a=r(1413),s=r(37762),u=r(93433),i=r(74165),o=r(15671),c=r(43144),l=r(60136),d=r(29388),p=r(15861),f=r(27366),h=(r(59486),r(52639)),y=r(76200),v=r(62044),m=r(10064),Z=r(93169),b=r(43404),x=r(54472),F=r(92026),g=r(18202),k=r(66978),R=r(35995),w=r(49861),O=(r(63780),r(25243),r(69912)),I=r(53866),S=r(77981);!function(e){e[e.PROJECT_VERTICES=1]="PROJECT_VERTICES"}(n||(n={}));var q=r(63543),_=r(64020),j=r(77946),E=r(90851),D=r(49818),T=r(86638),C=r(23084),J=r(19545),N=r(22585),A=r(11812);function Q(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function U(e,t){var r,n={},a=(0,s.Z)(e);try{for(a.s();!(r=a.n()).done;){var u,i=r.value,o=i.parentObjectId,c=i.parentGlobalId,l=i.attachmentInfos,d=(0,s.Z)(l);try{for(d.s();!(u=d.n()).done;){var p=u.value,f=p.id,h=(0,R.qg)((0,J.Dp)("".concat(t,"/").concat(o,"/attachments/").concat(f))),y=A.Z.fromJSON(p);y.set({url:h,parentObjectId:o,parentGlobalId:c}),n[o]?n[o].push(y):n[o]=[y]}}catch(v){d.e(v)}finally{d.f()}}}catch(v){a.e(v)}finally{a.f()}return n}function V(e,t,r){var n={query:(0,N.A)((0,a.Z)((0,a.Z)({},e.query),{},{f:"json"},Q(t)))};return r&&(n=(0,a.Z)((0,a.Z)((0,a.Z)({},r),n),{},{query:(0,a.Z)((0,a.Z)({},r.query),n.query)})),(0,y.default)(e.path+"/queryAttachments",n)}var G=r(99837);function P(){return P=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,C.en)(t),e.abrupt("return",V(s,G.Z.from(r),(0,a.Z)({},n)).then((function(e){return U(e.data.attachmentGroups,s.path)})));case 2:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}var M=r(34211),z=r(5192);function B(){return B=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,C.en)(t),e.abrupt("return",(0,z.executeQueryForExtent)(s,T.Z.from(r),(0,a.Z)({},n)).then((function(e){return{count:e.data.count,extent:I.Z.fromJSON(e.data.extent)}})));case 2:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}var L=r(24246);function X(e,t){var r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),!r.outFields||null!==t&&void 0!==t&&t.returnCountOnly?delete r.outFields:r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","),r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}function W(e,t,r){return Y.apply(this,arguments)}function Y(){return Y=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var u,o,c,l,d,p,f,h,y,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,r,n);case 2:u=e.sent,o=u.data,c=o.geometryType,l=o.spatialReference,d={},p=(0,s.Z)(o.relatedRecordGroups);try{for(p.s();!(f=p.n()).done;)if(h=f.value,y={fields:void 0,objectIdFieldName:void 0,geometryType:c,spatialReference:l,hasZ:!!o.hasZ,hasM:!!o.hasM,features:h.relatedRecords},null!=h.objectId)d[h.objectId]=y;else for(v in h)h.hasOwnProperty(v)&&"relatedRecords"!==v&&(d[h[v]]=y)}catch(i){p.e(i)}finally{p.f()}return e.abrupt("return",(0,a.Z)((0,a.Z)({},u),{},{data:d}));case 10:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function H(e,t,r){return K.apply(this,arguments)}function K(){return K=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var u,o,c,l,d,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,r,n,{returnCountOnly:!0});case 2:u=e.sent,o=u.data,c={},l=(0,s.Z)(o.relatedRecordGroups);try{for(l.s();!(d=l.n()).done;)null!=(p=d.value).objectId&&(c[p.objectId]=p.count)}catch(i){l.e(i)}finally{l.f()}return e.abrupt("return",(0,a.Z)((0,a.Z)({},u),{},{data:c}));case 8:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function $(e,t){return ee.apply(this,arguments)}function ee(){return ee=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,s,u,o=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},s=o.length>3?o[3]:void 0,u=(0,N.A)((0,a.Z)((0,a.Z)((0,a.Z)({},t.query),{},{f:"json"},s),X(r,s))),e.abrupt("return",(0,y.default)(t.path+"/queryRelatedRecords",(0,a.Z)((0,a.Z)({},n),{},{query:(0,a.Z)((0,a.Z)({},n.query),u)})));case 4:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}var te=r(99086);function re(){return re=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=te.Z.from(r),a=(0,C.en)(t),e.abrupt("return",W(a,r,n).then((function(e){var t=e.data,r={};return Object.keys(t).forEach((function(e){return r[e]=D.default.fromJSON(t[e])})),r})));case 3:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ne(){return ne=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=te.Z.from(r),s=(0,C.en)(t),e.abrupt("return",H(s,r,(0,a.Z)({},n)).then((function(e){return e.data})));case 3:case"end":return e.stop()}}),e)}))),ne.apply(this,arguments)}var ae=r(91340),se=r(68620),ue="Layer does not support extent calculation.";function ie(e,t,r,n){return oe.apply(this,arguments)}function oe(){return oe=(0,p.Z)((0,i.Z)().mark((function e(t,r,n,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(t,r,"json",a);case 2:return s=e.sent,e.abrupt("return",((0,se.p)(r,n,s.data),s));case 4:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}function ce(e,t,r){return le.apply(this,arguments)}function le(){return le=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.pC)(r.timeExtent)&&r.timeExtent.isEmpty?{data:{objectIds:[]}}:he(t,r,"json",n,{returnIdsOnly:!0}));case 1:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function de(e,t,r){return pe.apply(this,arguments)}function pe(){return pe=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,F.pC)(r.timeExtent)&&r.timeExtent.isEmpty?{data:{count:0,extent:null}}:he(t,r,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(ue);if(t.hasOwnProperty("count"))throw new Error(ue);return e})));case 1:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function fe(e,t,r){return(0,F.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):he(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function he(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u="string"==typeof e?(0,R.mN)(e):e,i=t.geometry?[t.geometry]:[];return n.responseType="pbf"===r?"array-buffer":"json",(0,ae.aX)(i,null,n).then((function(e){var i=e&&e[0];(0,F.pC)(i)&&((t=t.clone()).geometry=i);var o=(0,N.A)((0,a.Z)((0,a.Z)((0,a.Z)({},u.query),{},{f:r},s),function(e,t){var r,n,a=e.geometry,s=e.toJSON(),u=s;if((0,F.pC)(a)&&(u.geometry=JSON.stringify(a),u.geometryType=(0,S.Ji)(a),u.inSR=a.spatialReference.wkid||JSON.stringify(a.spatialReference)),null!==(r=s.topFilter)&&void 0!==r&&r.groupByFields&&(u.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),null!==(n=s.topFilter)&&void 0!==n&&n.orderByFields&&(u.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(u.topFilter=JSON.stringify(u.topFilter)),s.objectIds&&(u.objectIds=s.objectIds.join(",")),s.orderByFields&&(u.orderByFields=s.orderByFields.join(",")),s.outFields&&!(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?s.outFields.includes("*")?u.outFields="*":u.outFields=s.outFields.join(","):delete u.outFields,s.outSR?u.outSR=s.outSR.wkid||JSON.stringify(s.outSR):a&&s.returnGeometry&&(u.outSR=u.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){var i=s.timeExtent,o=i.start,c=i.end;null==o&&null==c||(u.time=o===c?o:"".concat(null!==o&&void 0!==o?o:"null",",").concat(null!==c&&void 0!==c?c:"null")),delete s.timeExtent}return u}(t,s)));return(0,y.default)((0,R.v_)(u.path,"queryTopFeatures"),(0,a.Z)((0,a.Z)({},n),{},{query:(0,a.Z)((0,a.Z)({},o),n.query)}))}))}var ye=r(54307);function ve(){return ve=(0,p.Z)((0,i.Z)().mark((function e(t,r,n,s){var u,o,c,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,C.en)(t),o=(0,a.Z)({},s),e.next=4,ie(u,ye.Z.from(r),n,o);case 4:return c=e.sent,l=c.data,e.abrupt("return",D.default.fromJSON(l));case 7:case"end":return e.stop()}}),e)}))),ve.apply(this,arguments)}function me(){return me=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,C.en)(t),e.next=3,ce(s,ye.Z.from(r),(0,a.Z)({},n));case 3:return e.abrupt("return",e.sent.data.objectIds);case 4:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function Ze(){return Ze=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,C.en)(t),e.next=3,de(s,ye.Z.from(r),(0,a.Z)({},n));case 3:return u=e.sent,e.abrupt("return",{count:u.data.count,extent:I.Z.fromJSON(u.data.extent)});case 5:case"end":return e.stop()}}),e)}))),Ze.apply(this,arguments)}function be(){return be=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,C.en)(t),e.next=3,fe(s,ye.Z.from(r),(0,a.Z)({},n));case 3:return e.abrupt("return",e.sent.data.count);case 4:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}var xe=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).dynamicDataSource=null,r.fieldsIndex=null,r.format="json",r.gdbVersion=null,r.infoFor3D=null,r.sourceSpatialReference=null,r}return(0,c.Z)(n,[{key:"execute",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeJSON(t,r);case 2:return n=e.sent,e.abrupt("return",this.featureSetFromJSON(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeJSON",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,s,u,o,c,l,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(0,a.Z)((0,a.Z)({},this.requestOptions),r),u=this._normalizeQuery(t),o=null!=(null===(n=t.outStatistics)||void 0===n?void 0:n[0]),c=(0,Z.Z)("featurelayer-pbf-statistics"),l=!o||c,"pbf"!==this.format||!l){e.next=13;break}return e.prev=2,e.next=5,(0,E.t)(this.url,u,s);case 5:d=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),"query:parsing-pbf"===e.t0.name){e.next=12;break}throw e.t0;case 12:this.format="json";case 13:if(e.t1="json"!==this.format&&l,e.t1){e.next=18;break}return e.next=17,(0,j.F)(this.url,u,s);case 17:d=e.sent;case 18:return this._normalizeFields(d.fields),e.abrupt("return",d);case 20:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"featureSetFromJSON",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,n,a){var s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queryIs3DObjectFormat(t)&&!(0,F.Wi)(this.infoFor3D)&&n.assetMaps&&n.features&&n.features.length){e.next=2;break}return e.abrupt("return",D.default.fromJSON(n));case 2:return e.next=4,(0,k.Hl)(Promise.all([r.e(5158),r.e(7898),r.e(9801)]).then(r.bind(r,29801)),a);case 4:return s=e.sent,u=s.meshFeatureSetFromJSON,e.abrupt("return",u(t,this.infoFor3D,n));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"executeForCount",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return(0,M.P)(this.url,n,r)}},{key:"executeForExtent",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return function(e,t,r){return B.apply(this,arguments)}(this.url,n,r)}},{key:"executeForIds",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return(0,L.G)(this.url,n,r)}},{key:"executeRelationshipQuery",value:function(e,t){e=te.Z.from(e);var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return re.apply(this,arguments)}(this.url,e,r)}},{key:"executeRelationshipQueryForCount",value:function(e,t){e=te.Z.from(e);var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return ne.apply(this,arguments)}(this.url,e,r)}},{key:"executeAttachmentQuery",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return function(e,t,r){return P.apply(this,arguments)}(this.url,e,r)}},{key:"executeTopFeaturesQuery",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return function(e,t,r,n){return ve.apply(this,arguments)}(this.parsedUrl,e,this.sourceSpatialReference,r)}},{key:"executeForTopIds",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return function(e,t,r){return me.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopExtents",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return function(e,t,r){return Ze.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopCount",value:function(e,t){var r=(0,a.Z)((0,a.Z)({},this.requestOptions),t);return function(e,t,r){return be.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"_normalizeQuery",value:function(e){var t=T.Z.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&((t=t===e?t.clone():t).gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?d.from(e.dynamicDataSource):this.dynamicDataSource),(0,F.pC)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){(t=t===e?t.clone():t).formatOf3DObjects=null;var r,n=(0,s.Z)(this.infoFor3D.queryFormats);try{for(n.s();!(r=n.n()).done;){var a=r.value;if("3D_glb"===a){t.formatOf3DObjects=a;break}"3D_gltf"!==a||t.formatOf3DObjects||(t.formatOf3DObjects=a)}}catch(g){n.e(g)}finally{n.f()}if(!t.formatOf3DObjects)throw new m.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,F.Wi)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,(0,F.Wi)(t.outFields)&&(t.outFields=[]);var u=this.infoFor3D.transformFieldRoles,i=u.originX,o=u.originY,c=u.originZ,l=u.translationX,d=u.translationY,p=u.translationZ,f=u.scaleX,h=u.scaleY,y=u.scaleZ,v=u.rotationX,Z=u.rotationY,b=u.rotationZ,x=u.rotationDeg;t.outFields.push(i,o,c,l,d,p,f,h,y,v,Z,b,x)}}return t}},{key:"_normalizeFields",value:function(e){if((0,F.pC)(this.fieldsIndex)&&(0,F.pC)(e)){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=this.fieldsIndex.get(n.name);a&&Object.assign(n,a.toJSON())}}catch(u){r.e(u)}finally{r.f()}}}},{key:"_queryIs3DObjectFormat",value:function(e){return(0,F.pC)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}}]),n}(r(4338).Z);(0,f._)([(0,w.Cb)({type:_.n})],xe.prototype,"dynamicDataSource",void 0),(0,f._)([(0,w.Cb)()],xe.prototype,"fieldsIndex",void 0),(0,f._)([(0,w.Cb)()],xe.prototype,"format",void 0),(0,f._)([(0,w.Cb)()],xe.prototype,"gdbVersion",void 0),(0,f._)([(0,w.Cb)()],xe.prototype,"infoFor3D",void 0),(0,f._)([(0,w.Cb)()],xe.prototype,"sourceSpatialReference",void 0);var Fe=xe=(0,f._)([(0,O.j)("esri.tasks.QueryTask")],xe),ge=r(25899),ke=r(62204),Re=r(78952),we=new b.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function Oe(e){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,p.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=3;break}return r=(0,R.sJ)(t),e.abrupt("return",r||{data:t});case 3:return e.abrupt("return",new Promise((function(e,r){var n=new FileReader;n.readAsDataURL(t),n.onload=function(){return e((0,R.sJ)(n.result))},n.onerror=function(e){return r(e)}})));case 4:case"end":return e.stop()}}),e)}))),Ie.apply(this,arguments)}var Se=new Set(["Feature Layer","Table"]),qe=new b.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"}),_e=function(e){(0,l.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).type="feature-layer",e.refresh=(0,k.Ds)((0,p.Z)((0,i.Z)().mark((function t(){var r,n,a,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.load();case 2:if(null!=(a=null===(r=e.sourceJSON.editingInfo)||void 0===r?void 0:r.lastEditDate)){t.next=5;break}return t.abrupt("return",{dataChanged:!0,updates:{}});case 5:return t.prev=5,t.next=8,e._fetchService(null);case 8:t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(5),t.abrupt("return",{dataChanged:!0,updates:{}});case 13:return s=a!==(null===(n=e.sourceJSON.editingInfo)||void 0===n?void 0:n.lastEditDate),t.abrupt("return",{dataChanged:s,updates:s?{editingInfo:e.sourceJSON.editingInfo,extent:e.sourceJSON.extent}:null});case 15:case"end":return t.stop()}}),t,null,[[5,10]])})))),e}return(0,c.Z)(r,[{key:"load",value:function(e){var t=(0,F.pC)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}},{key:"queryTask",get:function(){var e=this.layer,t=e.capabilities.query.supportsFormatPBF,r=e.parsedUrl,n=e.dynamicDataSource,a=e.infoFor3D,s=e.gdbVersion,u=e.spatialReference,i=e.fieldsIndex,o=(0,Z.Z)("featurelayer-pbf")&&t&&(0,F.Wi)(a)?"pbf":"json";return new Fe({url:r.path,format:o,fieldsIndex:i,infoFor3D:a,dynamicDataSource:n,gdbVersion:s,sourceSpatialReference:u})}},{key:"addAttachment",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/addAttachment",s=this._getLayerRequestOptions(),u=this._getFormDataForAttachment(r,s.query),e.prev=3,e.next=6,(0,y.default)(a,{body:u});case 6:return o=e.sent,e.abrupt("return",this._createFeatureEditResult(o.data.addAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,u,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return a=t.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+a+"/updateAttachment",u=this._getLayerRequestOptions({query:{attachmentId:r}}),o=this._getFormDataForAttachment(n,u.query),e.prev=3,e.next=6,(0,y.default)(s,{body:o});case 6:return c=e.sent,e.abrupt("return",this._createFeatureEditResult(c.data.updateAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(a,e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,o,c,l,d,p,f,h,v,m,Z,b,x,g,k,R,w,O,I,S,q,_,j,E,D,T,C,J,N,A,Q,U,V,G,P,M,z,B,L,X,W,Y,H,K=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:n=this.layer.infoFor3D,o=(0,F.pC)(n),c=o||(null===r||void 0===r?void 0:r.globalIdUsed),l=t.addFeatures.map((function(e){return K._serializeFeature(e,n)})),d=t.updateFeatures.map((function(e){return K._serializeFeature(e,n)})),p=this._getFeatureIds(t.deleteFeatures,c),(0,ke.P)(l,d,this.layer.spatialReference),f=[],h=[],v=(0,u.Z)(t.deleteAttachments),m=(0,s.Z)(t.addAttachments),e.prev=6,m.s();case 8:if((Z=m.n()).done){e.next=17;break}return b=Z.value,e.t0=f,e.next=13,this._serializeAttachment(b);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),m.e(e.t2);case 22:return e.prev=22,m.f(),e.finish(22);case 25:x=(0,s.Z)(t.updateAttachments),e.prev=26,x.s();case 28:if((g=x.n()).done){e.next=37;break}return k=g.value,e.t3=h,e.next=33,this._serializeAttachment(k);case 33:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 35:e.next=28;break;case 37:e.next=42;break;case 39:e.prev=39,e.t5=e.catch(26),x.e(e.t5);case 42:return e.prev=42,x.f(),e.finish(42);case 45:if(R=f.length||h.length||v.length?{adds:f,updates:h,deletes:v}:null,O=null,!o){e.next=56;break}O=new Map,I=[],S=(0,s.Z)(t.addAssets);try{for(S.s();!(q=S.n()).done;)_=q.value,I.push(this._serializeAssetMapEditAndUploadAssets(_,O))}catch(i){S.e(i)}finally{S.f()}return e.next=54,Promise.all(I);case 54:j=e.sent,w=j.length?{adds:j,updates:[],deletes:[]}:void 0;case 56:return E={gdbVersion:(null===r||void 0===r?void 0:r.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null===r||void 0===r?void 0:r.rollbackOnFailureEnabled,useGlobalIds:c,returnEditMoment:null===r||void 0===r?void 0:r.returnEditMoment,usePreviousEditMoment:null===r||void 0===r?void 0:r.usePreviousEditMoment,sessionId:null===r||void 0===r?void 0:r.sessionId},null!==r&&void 0!==r&&r.returnServiceEditsOption?(E.edits=JSON.stringify([{id:this.layer.layerId,adds:l,updates:d,deletes:p,attachments:R,assetMaps:(0,F.Wg)(w)}]),E.returnServiceEditsOption=we.toJSON(null===r||void 0===r?void 0:r.returnServiceEditsOption),E.returnServiceEditsInSourceSR=null===r||void 0===r?void 0:r.returnServiceEditsInSourceSR):(E.adds=l.length?JSON.stringify(l):null,E.updates=d.length?JSON.stringify(d):null,E.deletes=p.length?c?JSON.stringify(p):p.join(","):null,E.attachments=R&&JSON.stringify(R),E.assetMaps=(0,F.pC)(w)?JSON.stringify(w):void 0),D=this._getLayerRequestOptions({method:"post",query:E}),T=null!==r&&void 0!==r&&r.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,e.next=62,(0,y.default)(T+"/applyEdits",D);case 62:if(C=e.sent,!o||null==C.data||null==C.data.assetMaps){e.next=74;break}J=C.data,N=this.layer.objectIdField,A=[],Q=(0,s.Z)(J.addResults);try{for(Q.s();!(U=Q.n()).done;)(V=U.value).success&&A.push(V.objectId)}catch(i){Q.e(i)}finally{Q.f()}G=(0,s.Z)(J.updateResults);try{for(G.s();!(P=G.n()).done;)(M=P.value).success&&A.push(M.objectId)}catch(i){G.e(i)}finally{G.f()}return z=this._createRequestQueryOptions(),e.next=72,(0,y.default)(T+"/query",(0,a.Z)((0,a.Z)({},z),{},{query:{f:"json",formatOf3DObjects:"3D_glb",where:"OBJECTID IN (".concat(A.join(","),")"),outFields:"".concat(N)}}));case 72:if((B=e.sent)&&B.data&&B.data.assetMaps&&(0,F.pC)(O)){L=B.data.assetMaps,X=(0,s.Z)(L);try{for(X.s();!(W=X.n()).done;)Y=W.value,H=O.get(Y.parentGlobalId).geometry,(0,F.pC)(H)&&"mesh"===H.type&&H.updateExternalSource({source:[{name:Y.assetName,source:Y.assetName}],extent:H.extent})}catch(i){X.e(i)}finally{X.f()}}case 74:return e.abrupt("return",this._createEditsResult(C));case 75:case"end":return e.stop()}}),e,this,[[6,19,22,25],[26,39,42,45]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteAttachments",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/deleteAttachments",e.prev=3,e.next=6,(0,y.default)(a,this._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}));case 6:return e.abrupt("return",e.sent.data.deleteAttachmentResults.map(this._createFeatureEditResult));case 9:throw e.prev=9,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.signal;return this.load({signal:r}).then((0,p.Z)((0,i.Z)().mark((function r(){var n,s,u,o,c,l,d,p,f,h,m;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e._getLayerRequestOptions((0,a.Z)((0,a.Z)({},t),{},{query:{returnUpdates:!0}})),s=e.layer,u=s.layerId,o=s.url,r.next=6,(0,y.default)("".concat(o,"/").concat(u),n);case 6:return c=r.sent,l=c.data,d=l.id,p=l.extent,f=l.fullExtent,h=l.timeExtent,m=p||f,r.abrupt("return",{id:d,fullExtent:m&&I.Z.fromJSON(m),timeExtent:h&&v.Z.fromJSON({start:h[0],end:h[1]})});case 14:case"end":return r.stop()}}),r)}))))}},{key:"queryAttachments",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t){var r,n,a,u,o,c,l,d,p,f,h=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},n=this.layer.parsedUrl,a=n.path,e.next=4,this.load();case 4:if(u=this._getLayerRequestOptions(r),this.layer.get("capabilities.operations.supportsQueryAttachments")){e.next=10;break}o=t.objectIds,c=[],l=(0,s.Z)(o);try{for(l.s();!(d=l.n()).done;)p=d.value,f=a+"/"+p+"/attachments",c.push((0,y.default)(f,u))}catch(i){l.e(i)}finally{l.f()}return e.abrupt("return",Promise.all(c).then((function(e){return o.map((function(t,r){return{parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}}))})).then((function(e){return U(e,a)})));case 10:return e.abrupt("return",this.queryTask.executeAttachmentQuery(t,u));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.execute(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeJSON(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForIds(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForCount(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForExtent(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQuery(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeaturesCount",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQueryForCount(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopFeatures",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeTopFeaturesQuery(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopObjectIds",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopIds(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopExtents",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopExtents(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopCount",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopCount(t,(0,a.Z)((0,a.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchPublishingStatus",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(){var t,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ge.M8)(this.layer.url)){e.next=2;break}return e.abrupt("return","unavailable");case 2:return t=(0,R.v_)(this.layer.url,"status"),e.next=5,(0,y.default)(t,{query:{f:"json"}});case 5:return r=e.sent,e.abrupt("return",qe.fromJSON(r.data.status));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createRequestQueryOptions",value:function(e){var t=(0,a.Z)((0,a.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query);return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}},{key:"_fetchService",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var n,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=6;break}return e.next=3,(0,y.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,Z.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:r}));case 3:n=e.sent,a=n.data,t=a;case 6:if(this.sourceJSON=this._patchServiceJSON(t),s=t.type,Se.has(s)){e.next=10;break}throw new m.Z("feature-layer-source:unsupported-type",'Source type "'.concat(s,'" is not supported'));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_patchServiceJSON",value:function(e){var t;if("Table"!==e.type&&e.geometryType&&(null===e||void 0===e||null===(t=e.drawingInfo)||void 0===t||!t.renderer)&&!e.defaultSymbol){var r=(0,q.bU)(e.geometryType).renderer;(0,g.RB)("drawingInfo.renderer",r,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}},{key:"_serializeFeature",value:function(e,t){var r=e.geometry,n=e.attributes;if((0,F.pC)(t)&&(0,F.pC)(e.geometry)&&"mesh"===e.geometry.type){var s=(0,a.Z)({},n),u=e.geometry,i=u.origin,o=u.transform;if(s[t.transformFieldRoles.originX]=i.x,s[t.transformFieldRoles.originY]=i.y,s[t.transformFieldRoles.originZ]=i.z,(0,F.pC)(o)){var c=o.translation,l=o.scale,d=o.rotation;s[t.transformFieldRoles.translationX]=c[0],s[t.transformFieldRoles.translationY]=c[1],s[t.transformFieldRoles.translationZ]=c[2],s[t.transformFieldRoles.scaleX]=l[0],s[t.transformFieldRoles.scaleY]=l[1],s[t.transformFieldRoles.scaleZ]=l[2],s[t.transformFieldRoles.rotationX]=d[0],s[t.transformFieldRoles.rotationY]=d[1],s[t.transformFieldRoles.rotationZ]=d[2],s[t.transformFieldRoles.rotationDeg]=d[3]}return{geometry:null,attributes:s}}return(0,F.Wi)(r)?{attributes:n}:"mesh"===r.type||"extent"===r.type?null:{geometry:r.toJSON(),attributes:n}}},{key:"_serializeAttachment",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,c,l,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.feature,n=t.attachment,a=n.globalId,s=n.name,u=n.contentType,o=n.data,c=n.uploadId,l={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null},r&&(l.parentGlobalId="attributes"in r?r.attributes&&r.attributes[this.layer.globalIdField]:r.globalId),!c){e.next=5;break}l.uploadId=c,e.next=10;break;case 5:if(!o){e.next=10;break}return e.next=8,Oe(o);case 8:d=e.sent,l.contentType=d.mediaType,l.data=d.data,o instanceof File&&(l.name=o.name);case 10:return e.abrupt("return",(s&&(l.name=s),u&&(l.contentType=u),l));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_serializeAssetMapEditAndUploadAssets",value:function(){var e=(0,p.Z)((0,i.Z)().mark((function e(t,r){var a,s,u,o,c,l,d,p,f,h,v,Z,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.url,s=null,e.prev=2,u=new Blob([t.data],{type:t.mimeType}),(o=new FormData).append("f","json"),o.append("file",u,"".concat(t.assetName)),c={body:o,method:"post",responseType:"json"},e.next=8,(0,y.default)("".concat(a,"/uploads/upload"),c);case 8:if(l=e.sent,(d=l.data).success){e.next=12;break}throw new m.Z("feature-layer-source:upload-failure","Expected upload to be successfull.");case 12:s={assetType:t.assetType,assetUploadId:d.item.itemID},e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),s=null;case 18:if(!(0,F.Wi)(s)){e.next=25;break}return e.next=21,Oe(new Blob([t.data]));case 21:if((p=e.sent).isBase64){e.next=24;break}throw new m.Z("feature-layer-source:uploadAssets-failure","Expected gltf data in base64 format after conversion.");case 24:s={assetType:t.assetType,assetData:p.data};case 25:if(!(0,F.Wi)(s)){e.next=27;break}throw new m.Z("feature-layer-source:uploadAssets-failure","Unable to prepare uploadAsset request options.");case 27:return f={method:"post",query:{f:"json",assets:JSON.stringify([s])},responseType:"json"},e.next=30,(0,y.default)((0,R.v_)(this.layer.parsedUrl.path,"uploadAssets"),f);case 30:if(1===(h=e.sent).data.uploadResults.length&&h.data.uploadResults[0].success){e.next=33;break}throw new m.Z("feature-layer-source:uploadAssets-failure","Bad response.");case 33:return v=h.data.uploadResults[0].assetHash,Z=[],t.flags&n.PROJECT_VERTICES&&Z.push("PROJECT_VERTICES"),b={globalId:t.assetMapGlobalId,parentGlobalId:t.featureGlobalId,assetName:t.assetName,assetHash:v,flags:Z},e.abrupt("return",(r.set(t.featureGlobalId,t.feature),b));case 37:case"end":return e.stop()}}),e,this,[[2,15]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getFeatureIds",value:function(e,t){var r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}},{key:"_getIdsFromFeatures",value:function(e){var t=this.layer.objectIdField;return e.map((function(e){return e.attributes&&e.attributes[t]}))}},{key:"_canUseGlobalIds",value:function(e,t){return e&&"globalId"in t[0]}},{key:"_getObjectIdsFromFeatureIdentifier",value:function(e){return e.map((function(e){return e.objectId}))}},{key:"_getGlobalIdsFromFeatureIdentifier",value:function(e){return e.map((function(e){return e.globalId}))}},{key:"_createEditsResult",value:function(e){var t,r=this,n=e.data,a=this.layer.layerId,u=[],i=null;if(Array.isArray(n)){var o,c=(0,s.Z)(n);try{for(c.s();!(o=c.n()).done;){var l=o.value;u.push({id:l.id,editedFeatures:l.editedFeatures}),l.id===a&&(i={addResults:l.addResults,updateResults:l.updateResults,deleteResults:l.deleteResults,attachments:l.attachments,editMoment:l.editMoment})}}catch(v){c.e(v)}finally{c.f()}}else i=n;var d=null===(t=i)||void 0===t?void 0:t.attachments,p={addFeatureResults:i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:d&&d.addResults?d.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:d&&d.updateResults?d.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:d&&d.deleteResults?d.deleteResults.map(this._createFeatureEditResult,this):[]};if(i.editMoment&&(p.editMoment=i.editMoment),u.length>0){p.editedFeatureResults=[];var f,h=(0,s.Z)(u);try{var y=function(){var e=f.value,t=e.editedFeatures,n=t.adds,a=t.updates,s=t.deletes,u=t.spatialReference,i=u?new Re.Z(u):null;p.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null===n||void 0===n?void 0:n.map((function(e){return r._createEditedFeature(e,i)})))||[],updates:(null===a||void 0===a?void 0:a.map((function(e){return{original:r._createEditedFeature(e[0],i),current:r._createEditedFeature(e[1],i)}})))||[],deletes:(null===s||void 0===s?void 0:s.map((function(e){return r._createEditedFeature(e,i)})))||[],spatialReference:i}})};for(h.s();!(f=h.n()).done;)y()}catch(v){h.e(v)}finally{h.f()}}return p}},{key:"_createEditedFeature",value:function(e,t){return new h.Z({attributes:e.attributes,geometry:(0,S.im)((0,a.Z)((0,a.Z)({},e.geometry),{},{spatialReference:t}))})}},{key:"_createFeatureEditResult",value:function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new m.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}},{key:"_createAttachmentErrorResult",value:function(e,t){var r=t.details.messages&&t.details.messages[0]||t.message,n=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new m.Z("feature-layer-source:attachment-failure",r,{code:n})}}},{key:"_getFormDataForAttachment",value:function(e,t){var r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(var n in t){var a=t[n];null!=a&&(r.set?r.set(n,a):r.append(n,a))}return r}},{key:"_getLayerRequestOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.layer,r=t.parsedUrl,n=t.gdbVersion,s=t.dynamicDataSource;return(0,a.Z)((0,a.Z)({},e),{},{query:(0,a.Z)((0,a.Z)({gdbVersion:n,layer:s?JSON.stringify({source:s}):void 0},r.query),{},{f:"json"},this._createRequestQueryOptions(e)),responseType:"json"})}}]),r}(x.Z);(0,f._)([(0,w.Cb)()],_e.prototype,"type",void 0),(0,f._)([(0,w.Cb)({constructOnly:!0})],_e.prototype,"layer",void 0),(0,f._)([(0,w.Cb)({readOnly:!0})],_e.prototype,"queryTask",null);var je=_e=(0,f._)([(0,O.j)("esri.layers.graphics.sources.FeatureLayerSource")],_e)},34211:function(e,t,r){r.d(t,{P:function(){return c}});var n=r(74165),a=r(1413),s=r(15861),u=r(23084),i=r(5192),o=r(86638);function c(e,t,r){return l.apply(this,arguments)}function l(){return l=(0,s.Z)((0,n.Z)().mark((function e(t,r,s){var c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(0,u.en)(t),e.abrupt("return",(0,i.executeQueryForCount)(c,o.Z.from(r),(0,a.Z)({},s)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}},24246:function(e,t,r){r.d(t,{G:function(){return c}});var n=r(74165),a=r(1413),s=r(15861),u=r(23084),i=r(5192),o=r(86638);function c(e,t,r){return l.apply(this,arguments)}function l(){return l=(0,s.Z)((0,n.Z)().mark((function e(t,r,s){var c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(0,u.en)(t),e.abrupt("return",(0,i.executeQueryForIds)(c,o.Z.from(r),(0,a.Z)({},s)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}}}]);
//# sourceMappingURL=7870.e51e068e.chunk.js.map